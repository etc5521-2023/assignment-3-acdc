---
title: "Weeping Mulla Mulla: Ptilotus Calostachyus"
author: "**Team name:** ACDC </br> **Team members:** </br> Khuyen Nguyen _kngu0086@student.monash.edu_ </br> Khanh Pham _mpha0054@student.monash.edu_"
format: html
toc: true
editor: 
  markdown: 
    wrap: 72
---

```{r, echo=FALSE, message=FALSE}
library(galah)
library(kableExtra)
library(leaflet)
library(spData)
library(tidyverse)
```

## Introduction

The *Ptilotus calostachyus F.Muell*, which is also known as the
**Weeping Mulla Mulla**, is an endemic plant that is commonly found in
the Western Australia territory (Florabase n. d.). This species thrives
in arid region, particular in sandy habitats with red and stony
plains(1). Being a *perennial* plant, it can live up to more than two
years with the seasonal pattern of being dormant in the winter and
sprouting again in springtime - (1). Moreover, **Weeping Mulla Mulla**
displays erect or spreading, herb or shrub characteristics, meaning that
it can be found as a tall plant and/or covering an area, as well as
with/without a woody body. They can grow from 0.2 to 2 meters tall with
pink-white flowers, blooming from March to October. Despite the
widespread of its coverage, there are little to none organized sighting
campaign of the **Weeping Mulla Mulla** due to the outback nature of its
habitat and lesser popularity as compared to other iconic Australia
ecotourism species.

Five expectations when exploring the **Weeping Mulla Mulla** sighting:

-   We expect most of the sightings to occur between March to October.

-   We expect most of the sighting location to be in the Western
    Australia territory.

-   We expect the sightings to be consistent numbers of sightings with
    an increasing trend as sighting/reporting/monitoring methods become
    better. However, this anticipation may exclude years during the COVID-19 pandemic. Since the data relies on human observation, there may have been fewer sightings due to a lack of reporting.

-   We expect the sightings to be clustered in areas with a water source
    as the plant prefer harsh, dry, and hot sandy habitats.

-   We expect the sightings records to increase after rainfall events,
    as plants typically begin to bloom after wet season, which is around
    June - August for Perth.
    
![](https://static.inaturalist.org/photos/54862576/medium.jpg){fig-align="center"}

## Data description

```{=html}
<!--
2. Download all the occurrence records from the Atlas of Living Australia, ideally scripted using the `atlas_occurrences()` function from the `galah` package. Make sure you include date, time, collector identification details. Save this into a `data-raw` folder in your repo.
-->
```

### Species data

Below is the code to download the raw data directly from the [Atlas of Living Australia](https://www.ala.org.au/).

The basis of record was filtered to `HUMAN_OBSERVATION` only. This decision was made because we intended to focus solely on sightings of the species in the wild, and differentiate between specimens that were preserved, collected samples, or in controlled environments such as museums. 

We have also checked the `BASIS_OF_RECORD_INVALID` to determine
the reliability of each observation, in which all the `TRUE` results
were removed in the process of sub-setting `HUMAN_OBSERVATION` entry in
the `basisOfRecord`.

The other options, such as `LIVING SPECIMEN`, could imply captivity or control, `PRESERVED SPECIMEN` typically refers to non-living specimens, and `OCCURRENCE` was too general to confirm its wild state.

```{r raw-data, eval=FALSE, echo=FALSE, message=FALSE, warning=FALSE}
galah_config(email = "mpha0054@student.monash.edu",
             download_reason_id = 10, 
             verbose = TRUE)

raw_data <- ala_occurrences(
  taxa = select_taxa("Ptilotus calostachyus"))

save(raw_data, file = "data-raw/raw_data.rda")
```

```{r message=FALSE, warning=FALSE}
galah_config(email = "mpha0054@student.monash.edu",
             download_reason_id = 10, 
             verbose = TRUE)

storage <- galah_call() %>%
  galah_identify("Weeping mulla mulla") %>%
  galah_select(
    basisOfRecord, decimalLatitude, decimalLongitude, eventDate, scientificName,
    taxonConceptID, recordID, dataResourceName, eventRemarks, eventTime, eventID,
    eventDate, samplingEffort, samplingProtocol, cl959,
    group = c("basic", "event")
  ) %>%
  atlas_occurrences() %>%
  filter(basisOfRecord == "HUMAN_OBSERVATION")
```

The data obtained from the Atlas of Living Australia website combines information from multiple sources and includes various variables such as location, date, time, scientific names, resource names, species status, and more. The raw data set contains `r nrow(storage)` observations and `r ncol(storage)` variables.

For the analysis, the data is filtered to primarily focus on utilising the location and event time data. This is because the other variables do not contribute significantly to meaningful insights. However, a comprehensive dictionary of all the variables is provided below:

```{r data-dictionary, echo=FALSE, warning=FALSE}
dictionary <- data.frame(
  Variable = c("decimalLatitude", "decimalLongitude", "eventDate", "scientificName", "taxonConceptID", "recordID", "dataResourceName",  "occurrenceStatus", "eventRemarks", "eventTime", "eventID", "samplingEffort", "samplingProtocol", "basisOfRecord", "cl959"),
  Description = c(
    "Latitude value of sighting in decimal format.",
    "Longitude value of sighting in decimal format.",
    "Recorded sighting date and time in the format YYYY-MM-DD, hh:mm:ss. In some cases, no time was recorded, and therefore, it is left as 00:00:00.",
    "The scientific name of the observed species.",
    "The taxonomy website ID: [Ptilotus calostachyus](https://id.biodiversity.org.au/node/apni/2910906).",
    "The record ID of each observation.",
    "The data resource associated with the observation: [List of 23 partners](https://bie.ala.org.au/species/https://id.biodiversity.org.au/node/apni/2910906#data-partners).",
    "The occurrence status: Present.",
    "Any additional remarks or comments related to the observation.",
    "Time of the event recorded in the format hh:mm:ss, including the time zone difference.",
    "The event ID of each obsercation.",
    "A description of the effort or area that was surveyed or sampled to locate the species.",
    "The protocol that was used to sample the species.",
    "Indicates how the record was made: Human observation.",
    "Denotes the local government area where the observation was made."
  )
)

kable(dictionary, format = "markdown")
```

```{r species-data-cleaning}
weeping_mulla_mulla <- storage %>%
  select(decimalLongitude, decimalLatitude, eventDate, cl959) %>%
  rename(longitude = decimalLongitude,
         latitude = decimalLatitude,
         lga = cl959) %>%
  mutate(
    eventDate = as.Date(eventDate),
    Year = lubridate::year(eventDate),
    Month = lubridate::month(eventDate),
    monthName = lubridate::month(eventDate, label = TRUE, abbr = TRUE),
    Day = lubridate::day(eventDate),
    lga = str_remove(lga, "\\(.*")
  ) %>%
  filter(!is.na(eventDate)) %>%
  filter(!is.na(longitude)) 
save(weeping_mulla_mulla, file = ("data/weeping_mulla_mulla.rda"))
```

### Weather data

**Obtaining weather station data**

The distribution of the **Weeping Mulla Mulla** commonly spans the local government areas (LGAs) of Ashburton, Broome, Derby-West Kimberley, East Pilbara, Halls Creek, Karratha, Laverton, Meekatharra, Ngaanyatjarraku, Port Hedland, Upper Gascoyne, and Wyndham-East Kimberley, as per findings from ([Florabase](https://florabase.dbca.wa.gov.au/browse/profile.php/2704)).

Since weather is an important factor in the occurrences of species, the Global Historical Climatology Network (GHCN) database contains weather station data that are useful for analysing trends in weather patterns and precipitation. Obtaining the data via the `rnoaa` package for Australia was completed using the code below:

```{r weather-data, warning=FALSE, message=FALSE}
library(rnoaa)
aus_stations <- ghcnd_stations() |>
  filter(str_starts(id, "ASN")) |>
  filter(last_year >= 2020) |> 
  mutate(wmo_id = as.numeric(wmo_id),
         name = str_to_lower(name)) |>
  select(-state, -gsn_flag) |>
  filter(element %in% c("PRCP", "TMAX", "TMIN")) |>
  nest(element: last_year) |>
  rowwise() |>
  filter(nrow(data) == 3) |>
  select(-data) 
```

Next, when filtering the weather stations to be within the vicinity of **Weeping Mulla Mulla**, it becomes evident that the **Weeping Mulla Mulla** is found in the vicinity of 42 weather stations.

```{r, echo=FALSE, results=FALSE}
range(weeping_mulla_mulla$longitude)
range(weeping_mulla_mulla$latitude)

aus_stations_filtered <- aus_stations %>% 
  filter(115.6102 <= longitude & longitude <= 137.1930,
         -24.92637 <= latitude & latitude <= -15.14837)
```

```{r echo=FALSE}
data(world, package = "spData")
australia <- world[world$iso_a2 == "AU", ]

australia_plot <- ggplot(australia) + geom_sf(fill = "#5b9b2e")

combined_plot <- australia_plot +
  geom_point(data = weeping_mulla_mulla,
             aes(x = longitude, y = latitude),
             colour = "#c599b2", alpha= 0.3, size = 2.5) +
  labs(title = "Weeping Mulla Mulla Sightings and Weather Stations", 
       x = "Longitude", 
       y = "Latitude", 
       subtitle = "1987 - Present") +
  theme_minimal()

combined_plot +
  geom_point(
    data = aus_stations_filtered,
    aes(
      x = longitude,
      y = latitude,
      color = name == "tennant creek airport"
    ),
    shape = 2
  ) +
  scale_color_manual(values = c("FALSE" = "#222233", "TRUE" = "white")) +
  theme(legend.position = "none")
```
```{r echo=FALSE}
weeping_mulla_mulla %>%
  leaflet() %>%
  addProviderTiles("Esri.DeLorme") %>%
  setView(lat = -21.833, lng = 128.583, zoom = 5) %>%
  addCircleMarkers(lng = ~longitude, 
                   lat = ~latitude,  
                   stroke = FALSE, 
                   fillOpacity = 0.1,
                   color = "#c599b2",
                   radius = 10) %>%
  addCircleMarkers(data = aus_stations_filtered,  
                   lng = ~longitude,
                   lat = ~latitude,
                   stroke = FALSE, 
                   fillOpacity = 1,  
                   color = "#222233",      
                   radius = 3) %>% 
   addCircleMarkers(data = aus_stations_filtered %>% filter(name == "tennant creek airport"),
                   lng = ~longitude,
                   lat = ~latitude,
                   stroke = FALSE, 
                   fillOpacity = 1,  
                   color = "red",      
                   radius = 5)
```

The triangles on the map represent the locations of 42 weather stations. The purple points, with varying alpha and size settings, help to identify the areas with the highest occurrence rates. Notably, the white triangle represents the Tennant Creek Airport weather station, which records the majority of observations. Given this focus, the analysis can be narrowed down by filtering the weather station data specifically for Tennant Creek.

**Obtaining weather data for Tennant Creek**

The code for obtaining precipitation, maximum temperature, and minimum temperature data for the town is provided below:

```{r, warning=FALSE, message=FALSE}
tennant_creek_airport <- aus_stations |>
  filter(id == "ASN00015135") |>
  rowwise() |>
  mutate(ts = list(meteo_pull_monitors(
    monitors = id, var = c("PRCP", "TMAX", "TMIN"),
    date_min = "2004-01-01",
    date_max = "2023-09-13") |>
      select(-id))) |>
  rename(lat = latitude, long = longitude, elev = elevation) |> 
  select(id, long, lat, elev, name, wmo_id, ts) %>%
  unnest(ts) |>
  mutate(tmax = tmax/10, tmin = tmin/ 10)
```

**Tennant Creek in Barkly Region**

The species dataset includes local government information, and as Tennant Creek is situated in the Barkly region, the final step is to integrate temperature data from weather stations into observations within the Barkly region, creating a comprehensive dataset encompassing both observations and temperature data.

```{r}
temperature <- weeping_mulla_mulla %>%
  left_join(tennant_creek_airport, by = c("eventDate" = "date")) %>%
  filter(!is.na(tmax) & !is.na(tmin)) %>% 
  select(latitude:Day, prcp:tmin) %>% 
  mutate(sighting = ifelse(lga == "Barkly ", 1, 0)) %>% 
  mutate_at(vars(prcp:tmin), ~ifelse(sighting == 0, NA, .))

save(temperature, file = ("data/temperature.rda"))
```

## Initial data analysis

```{=html}
<!--
3. Perform a data quality check, and then go ahead and clean the data, saving only the wild sightings. Save the resulting data in a `data` folder as an `WILD_THING_COMMON_NAME.rda` file, so that any special variable types are clearly available. (Replace `WILD_THING_COMMON_NAME` with lower case common name of your assigned wild thing.) *Note:* Some are museum or historical records or live in an animal sanctuary or zoo, which do not truly capture their wild behaviour. Downloading the event information (`galah_select(group = "event")`) can help identify wild sightings.

Weather data pre-processing here too.
-->
```

### Checking data quality

We will be using `visdat` library to check for data type errors

```{r message=FALSE, warning=FALSE}
library(visdat)

vis_dat(weeping_mulla_mulla)
```

**Discussion** The result of `visdat` does not signify any anomalies
that needed to be addressed before proceeding with further analysis.

```{r message=FALSE, warning=FALSE}
vis_guess(weeping_mulla_mulla)
```

**Discussion** `vis_guess` shows that the *longitude* and *latitude*
columns both have a record with potentially integer coordinates entry.
While this is a sign of rounding given that the coordinates span from a
length of values with 5 decimal places precision, we believe this value
does not need any alterations as sighting coordinates span across a very
wide geographical area, making rounding to the nearest whole number (1.0
degree is 111 kilometers) insignificant in our spatial analysis.

## Exploratory data analysis

### Spatial expectation

To evaluate the spatial distribution of the species, a method involving the use of a map to pinpoint locations was employed. This was achieved by utilising the `spData` package in conjunction with its `world` data.

The initial expectation was that the majority of sightings would be concentrated in Western Australia. 

The map displaying the sightings below validates the initial hypothesis. However, it also reveals a significant number of sightings in the Northern Territory.

Most of the sightings are clustered in the northern regions of Western Australia, aligning with expectations. Notably, there are no sightings in the southern areas of Western Australia, including the city of Perth.

```{r, echo=FALSE}
data(world, package = "spData")
australia <- world[world$iso_a2 == "AU", ]

australia_plot <- ggplot(australia) + geom_sf(fill = "#5b9b2e")

combined_plot <- australia_plot +
  geom_point(data = weeping_mulla_mulla,
             aes(x = longitude, y = latitude),
             colour = "#c599b2") +
  labs(title = "Weeping Mulla Mulla Sightings Across Australia", 
       x = "Longitude", 
       y = "Latitude", 
       subtitle = "1987 - Present") +
  theme_minimal()

combined_plot
```

### Temporal expectation

To assess the temporal occurrences of the species, the same method of using a map to pinpoint locations was employed. However, an additional step was introduced, involving the segmentation of the data by month to distribute the results throughout the year.

The initial expectation was that the **Weeping Mulla Mulla** would exhibit a higher frequency of observations from March to October.

The map displaying the sightings by month validates this initial hypothesis, as there are fewer data points on the map in January and February, as well as in November and December.

Interestingly, a new insight emerges when the data is segmented by month. The previous map showed the regions where observations were most frequent, namely Western Australia and the Northern Territory. Now, when the data is subset by month, it becomes apparent that these two regions remain the primary clusters.


```{r, echo = FALSE}
combined_plot +
  facet_wrap(~monthName, ncol = 6) +
  theme_void() +
  labs(title = "Weeping Mulla Mulla Sightings By Month")
```

### Trend expectation

Since the data relies on human observation, it was anticipated that there might have been fewer sightings due to a lack of reporting.

By employing a simple method of plotting the number of observations against the years using a histogram, it can be seen that there was no indication of reduced observations during the COVID-19 years from 2000 to 2021. In fact, 2021 recorded the second-highest number of observations for the species.

Nevertheless, an interesting new observation stands out - a significant spike in sightings occurred in 2015. This spike was the highest, surpassing even the sightings in 2021, with 108 observations compared to 34, which is more than three times as many.

Currently, there are no findings that can explain this phenomenon.

```{r, echo=FALSE, warning =FALSE}
weeping_mulla_mulla %>%
  group_by(Year) %>%
  count() %>%
  ggplot(aes(x = Year, y = n, fill = as.factor(Year))) +
  geom_histogram(stat = "identity") +
  scale_fill_manual(values = c("2020" = "#c599b2", "2021" = "#c599b2")) +
  labs(
    title = "Weeping Mulla Mulla Observations by Year",
    y = "Number of observations"
  ) +
  theme_minimal() +
  theme(legend.position = "none", legend.title = element_blank())
```

### Seasonality expectation

To test whether our expectation that the **Weeping Mulla Mulla** becomes
more active after rainfall seasons is accurate, we decided to plot the
occurrences by month. While there are some indications from the previous
*Temporal expectation* section, where June to August plots show
considerably more observation points, we would like create a bar plot
for a better visualization inference.

```{r}
weeping_mulla_mulla %>%
  group_by(monthName) %>%
  count() %>%
  ggplot(aes(x = monthName, y = n, fill = as.factor(monthName))) +
  geom_bar(stat = "identity", col = "#5b9b2e") +
  scale_fill_manual(values = c("Jun" = "#c599b2", 
                               "Jul" = "#c599b2", 
                               "Aug" = "#c599b2")) +
  labs(
    title = "Weeping Mulla Mulla Observations by Month",
    y = "Number of observations",
    x = "Month"
  ) +
  theme_minimal() +
  theme(legend.position = "none", legend.title = element_blank())
```

Interestingly, we observe decreased sightings during June and July while
August has the highest sighting occurrences. March marks the start of
the blooming cycle with April and May being the autumn season in Western
Australia (Tourism Australia n. d.), which has occasional showers. This
explains the large rise in sightings for these months. However, the main
raining events (June to August) saw significantly lower occurrences - we
believe this is due to thunderstorms and flooding, preventing casual
observers to stumble upon these plants. Only August has high sighting
occurrences, as the end of winter has milder downpours.


### Habitat expectation

Given that the **Weeping Mulla Mulla** prefers stony and sandy
environments, we expect the plants to be sighted near areas with
freshwater such as river banks,... Moreover, observations by travelers
might be more likely to be located near and/or on the way to a water
source. To test our this expectation, we deploy a `leaflet` map, which
displays geographical features such as subsurface water, creeks, lakes,
and rivers.

```{r}
library(leaflet)

weeping_mulla_mulla %>%
  leaflet() %>%
  addProviderTiles("Esri.DeLorme") %>%
  setView(lat = -21.833, lng = 128.583, zoom = 5) %>%
  addCircleMarkers(lng = ~longitude, 
                   lat = ~latitude,  
                   stroke = FALSE, 
                   fillOpacity = 0.1
)
```

Due to the zoom level, we could not see the water body features of the
map; Therefore, we decided to investigate a cluster of sightings near
Ali Curung.

```{r}
library(leaflet)

weeping_mulla_mulla %>%
  leaflet() %>%
  addProviderTiles("Esri.DeLorme") %>%
  setView(lat = -20.9358, lng = 134.2996, zoom = 10) %>%
  addCircleMarkers(lng = ~longitude, 
                   lat = ~latitude,  
                   stroke = FALSE, 
                   fillOpacity = 0.3, 
                   color = "#5b9b2e"
) 
```

Based on the map above, we can see that the main cluster of **Weeping
Mulla Mulla** does not live near a water source, which is different from
what we expected. This suggests that the plant is dependent on rain,
meaning that high precipitation periods might lead to higher sightings.
It is also interesting to see that these sightings were near the
National 87 road, implying that these reports were made by passersby.

## Summary

## References

### Websites
 - **iNaturalist**. Ptilotus calostachyus Image., Retrieved October 03, 2023, from https://www.inaturalist.org/taxa/869581-Ptilotus-calostachyus.
 - **Florabase**, Ptilotus calostachyus F.Muell., Retrieved September 29, 2023, from https://florabase.dbca.wa.gov.au/browse/profile.php/2704
 - **The Atlas of Living Australia**. Ptilotus calostachyus F.Muell.Retrieved September 27, 2023, from https://bie.ala.org.au/species/https://id.biodiversity.org.au/node/apni/2910906#overview

### Packages
 - **leaflet**: Cheng J, Schloerke B, Karambelkar B, Xie Y (2023). _leaflet: Create Interactive Web Maps with the JavaScript 'Leaflet' Library_. R package version 2.2.0,
  https://CRAN.R-project.org/package=leaflet.
 - **galah**: Westgate M, Kellie D, Stevenson M, Newman P (2023). _galah: Biodiversity Data from
  the Living Atlas Community_. R package version 1.5.3,
  https://CRAN.R-project.org/package=galah.
 - **kableExtra**: Zhu H (2021). _kableExtra: Construct Complex Table with 'kable' and Pipe Syntax_. R package version 1.3.4, https://CRAN.R-project.org/package=kableExtra.
 - **spData**: Bivand R, Nowosad J, Lovelace R (2023). _spData: Datasets for Spatial Analysis_. R
 - **tidyverse**:  Wickham H, Averick M, Bryan J, Chang W, McGowan LD, François R, Grolemund G, Hayes A, Henry L, Hester J, Kuhn M, Pedersen TL, Miller E, Bache SM, Müller K, Ooms J, Robinson D, Seidel DP, Spinu V, Takahashi K, Vaughan D, Wilke C, Woo K, Yutani H (2019). “Welcome to the tidyverse.” _Journal of Open Source Software_, *4*(43), 1686. doi:10.21105/joss.01686 https://doi.org/10.21105/joss.01686.
 - **visdat**: Tierney N (2017). “visdat: Visualising Whole Data Frames.” _JOSS_, *2*(16), 355.
  doi:10.21105/joss.00355 https://doi.org/10.21105/joss.00355, http://dx.doi.org/10.21105/joss.00355.


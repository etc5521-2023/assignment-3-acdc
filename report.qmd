---
title: "Weeping Mulla Mulla: Ptilotus Calostachyus"
author: "**Team name:** ACDC **Team members:** Khuyen Nguyen kngu0086@student.monash.edu & Khanh Pham"
format: html
---

## Introduction

 - We expect the species to thrive in dry conditions, with temperatures ranging from approximately 24 to 34 degrees Celsius _(TravelOnline Australia)_.
 - We anticipate that there may have been fewer sightings during the COVID-19 pandemic. Since the data relies on volunteer work, there might have been fewer sightings due to a lack of reporting during this time.

## Data description

Below is the code to download the raw data directly from the [Atlas of Living Australia](https://www.ala.org.au/).

The basis of record was filtered to "human observations" only. This decision was made because we intended to focus solely on sightings of the species in the wild, rather than any specimens that were preserved or in controlled environments. The other options, such as "living specimen," could imply captivity or control, "preserved specimen" typically refers to non-living specimens, and "occurrence" is too general to confirm its wild state.

```{r species-data, message=FALSE}
library(kableExtra)
library(galah)
library(spData)
library(tidyverse)
galah_config(email = "kngu0086@student.monash.edu",
             download_reason_id = 10,
             verbose = FALSE)
rawdata <- galah_call() %>%
  galah_identify("Weeping mulla mulla") %>%
  galah_select(
    basisOfRecord ,
    decimalLatitude,
    decimalLongitude,
    eventDate,
    scientificName,
    taxonConceptID,
    recordID,
    dataResourceName,
    eventRemarks,
    eventTime,
    eventID,
    eventDate,
    samplingEffort,
    samplingProtocol,
    group = c("basic", "event")
  ) %>%
  atlas_occurrences() %>%
  filter(basisOfRecord == "HUMAN_OBSERVATION")
save(rawdata, file = "data-raw/rawdata.rda")
```

The data is sourced from the Atlas of Living Australia website, which aggregates multiple data sources and includes variables indicating location, date, time, scientific name, resource names, and species status. There are `r nrow(rawdata)` observations and `r ncol(rawdata)` variables in the raw data set.

For our analysis, we will primarily utilise the location and event time data. However, a comprehensive dictionary is provided below:

```{r data-dictionary, echo=FALSE, warning=FALSE}
dictionary <- data.frame(
  Variable = c("decimalLatitude", "decimalLongitude", "eventDate", "scientificName", "taxonConceptID", "recordID", "dataResourceName",  "occurrenceStatus", "eventRemarks", "eventTime", "eventID", "samplingEffort", "samplingProtocol", "basisOfRecord"),
  Description = c(
    "Latitude value of sighting in decimal format.",
    "Longitude value of sighting in decimal format.",
    "Recorded sighting date and time in the format YYYY-MM-DD, hh:mm:ss. In some cases, no time was recorded, and therefore, it is left as 00:00:00.",
    "The scientific name of the observed species.",
    "The taxonomy website ID: [Ptilotus calostachyus](https://id.biodiversity.org.au/node/apni/2910906).",
    "The record ID of each observation.",
    "The data resource associated with the observation: [List of 23 partners](https://bie.ala.org.au/species/https://id.biodiversity.org.au/node/apni/2910906#data-partners).",
    "The occurrence status: Present.",
    "Any additional remarks or comments related to the observation.",
    "Time of the event recorded in the format hh:mm:ss, including the time zone difference.",
    "The event ID of each obsercation.",
    "A description of the effort or area that was surveyed or sampled to locate the species.",
    "The protocol that was used to sample the species.",
    "Indicates how the record was made: Human observation."
  )
)

kable(dictionary, format = "markdown")
```

## Initial data analysis

```{r species-data-cleaning}
weeping_mulla_mulla <- rawdata %>%
  select(decimalLongitude, decimalLatitude, eventDate) %>%
  rename(longitude = decimalLongitude,
         latitude = decimalLatitude) %>%
  mutate(
    eventDate = as.Date(eventDate),
    Year = lubridate::year(eventDate),
    Month = lubridate::month(eventDate),
    monthName = lubridate::month(eventDate, label = TRUE, abbr = TRUE),
    Day = lubridate::day(eventDate)
  ) %>%
  filter(!is.na(eventDate)) %>%
  filter(!is.na(longitude))
save(weeping_mulla_mulla, file = ("data/weeping_mulla_mulla.rda"))
```

```{r weather-data, warning=FALSE, message=FALSE}
library(rnoaa)
aus_stations <- ghcnd_stations() |>
  filter(str_starts(id, "ASN")) |>
  filter(last_year >= 2020) |> 
  mutate(wmo_id = as.numeric(wmo_id),
         name = str_to_lower(name)) |>
  select(-state, -gsn_flag) |>
  filter(element %in% c("PRCP", "TMAX", "TMIN")) |>
  nest(element: last_year) |>
  rowwise() |>
  filter(nrow(data) == 3) |>
  select(-data) 
```

The distribution of the Weeping Mulla Mulla commonly spans the local government areas (LGAs) of Ashburton, Broome, Derby-West Kimberley, East Pilbara, Halls Creek, Karratha, Laverton, Meekatharra, Ngaanyatjarraku, Port Hedland, Upper Gascoyne, Wyndham-East Kimberley, as per ([Florabase](https://florabase.dbca.wa.gov.au/browse/profile.php/2704)).

As such, we can subset the temperature data for some of these specific suburbs.

broome airport ASN00003003
derby aero ASN00003032
halls creek airport ASN00002012
karratha aero ASN00004083
laverton aero ASN00012305
laverton raaf ASN00087031
meekatharra airport ASN00007045
port hedland airport ASN00004032
gascoyne junction ASN00006022
wynyard airport ASN00091107
wyndham aero ASN00001006

```{r, warning=FALSE, message=FALSE}
broomeairport <- aus_stations |>
  filter(id == "ASN00003003") |>
  rowwise() |>
  mutate(ts = list(meteo_pull_monitors(
    monitors = id, var = c("PRCP", "TMAX", "TMIN"),
    date_min = "2004-01-01",
    date_max = "2023-09-13") |>
      select(-id))) |>
  rename(lat = latitude, long = longitude, elev = elevation) |> select(id, long, lat, elev, name, wmo_id, ts) %>%
  unnest(ts) |>
  mutate(tmax = tmax/10, tmin = tmin/ 10)
```

## Exploratory data analysis

**Spatial expectation**

We expect most of the sighting locations to be in Western Australia territory. The plot of sightings below has met our expectations; however, there are also many sightings in the Northern Territory.

```{r}
data(world, package = "spData")
australia <- world[world$iso_a2 == "AU", ]

australia_plot <- ggplot(australia) + geom_sf(fill = "#5b9b2e")

combined_plot <- australia_plot +
  geom_point(data = weeping_mulla_mulla,
             aes(x = longitude, y = latitude),
             colour = "#c599b2",) +
  labs(title = "Weeping Mulla Mulla Sightings Across Australia", x = "Longitude", y = "Latitude", subtitle = "1987 - Present") +
  theme_minimal()

combined_plot
```

**Temporal expectation**

We expect sightings of the Weeping Mulla Mulla to be more frequent from March to October. This expectation aligns with our observations, as there are fewer points on the map in January, February, November, and December.

```{r}
combined_plot +
  facet_wrap(~monthName, ncol = 6) +
  theme_void() +
  labs(title = "Weeping Mulla Mulla Sightings By Month")
```
So far, the map data has shown us the areas where observations are most frequent. We can see that there are primarily two clusters, one in Western Australia and another in the Northern Territory. These clusters are also evident on some of the maps by month.

**Trend expectation**

```{r}
weeping_mulla_mulla %>%
  group_by(Year) %>%
  count() %>%
  ggplot(aes(x = Year, y = n, fill = as.factor(Year))) +
  geom_histogram(stat = "identity") +
  scale_fill_manual(values = c("2020" = "#c599b2", "2021" = "#c599b2")) +
  labs(
    title = "Weeping Mulla Mulla Observations by Year",
    y = "Number of observations"
  ) +
  theme_minimal() +
  theme(legend.position = "none", legend.title = element_blank())
```

We can see that the yearly observations do not meet our expectation of reduced observations during COVID-19. There was no decrease in observations from 2000 to 2021.

## Summary 

## References

 - Florabase, Ptilotus calostachyus F.Muell., Retrieved September 29, 2023, from https://florabase.dbca.wa.gov.au/browse/profile.php/2704
 - TravelOnline Australia Pty Ltd. Western Australia Weather & Climate. Retrieved September 27, 2023, from https://www.travelonline.com/western-australia/weather
 - The Atlas of Living Australia. Ptilotus calostachyus F.Muell.Retrieved September 27, 2023, from https://bie.ala.org.au/species/https://id.biodiversity.org.au/node/apni/2910906#overview


